KERNEL=`uname -s`

# general
alias sshkey='cat ~/.ssh/id_rsa.pub | pbcopy && echo Public key copied to clipboard.'
alias cls='clear'

# directories
alias back='cd - > /tmp/nul'
alias ..='cd ..'
alias .2='cd ../..'
alias .3='cd ../../..'
alias .4='cd ../../../..'

if [[ "$KERNEL" == "Linux" ]]; then
  alias dir='ls -al --color'
  alias open="gnome-open"
  alias guivim='gvim'
else
  alias dir='ls -GlAh'
  alias guivim='mvim'
  alias gx='gitx --all'
fi

function et() {
  if [ "$1" != "" ]; then
    guivim -c "$1"
  else
    guivim
  fi
}

function ti() {
  local verb
  verb="run"
  [[ "$1" == "" ]] || verb="$1"
  /Library/Application\ Support/Titanium/mobilesdk/osx/latest/titanium.py $verb --platform=iphone
}

alias desktop='cd ~/Desktop'
alias sites='cd ~/Sites/'

# mark and go mark
alias m='echo "cd \"$PWD\"" > ~/.working-directory'
alias gm='test -r ~/.working-directory && source ~/.working-directory'

# git
alias pull='git pull'
alias push='git push'
alias gup='git pull'
alias gco='git checkout'
alias gc='git commit -v -a'
alias gcm='git commit -a -m'
alias gsta='git status'
alias gb='git branch'
alias gadd='git add'
alias giff='git diff'
alias grm="git status | grep deleted | awk '{print \$3}' | xargs git rm"
alias squash='git merge --squash'
alias stash='git stash'
alias gitlog='git log --pretty=format:"%Cblue%h%Creset %Cred%ad%Creset %Cgreen%an%Creset %s"'
alias gcp='git cherry-pick'

# svn
alias supe='svn update'
alias stae='svn status | sed -E "/(^$|^X|external item)/d"'
alias svncm='svn commit -m'
alias svnmv='svn rename'
alias svnren='svn rename'
alias svnignore='svn propedit svn:ignore'
alias svnrm='svn delete'
alias sdm='svn diff . | mate'

# mongrel
alias mr='mongrel_rails start'
alias mrp='mongrel_rails start -e production'
alias mrd='script/server --debugger'

# rails
alias ss='script/server'
alias sc='script/console'
alias sg='script/generate'
alias sgm='sg migration'
alias sgc='sg controller'
alias sp='script/plugin'
alias sr='script/runner'
alias a='autotest -rails'
alias tlog='tail -f log/development.log'
alias migrate='rake db:migrate db:test:clone'
alias rst='touch tmp/restart.txt'

alias harvest='open https://igicom.harvestapp.com/daily'

# server
alias reloadapache='sudo httpd -k graceful'
alias ehttpdmain='$EDITOR /Applications/xampp/etc/httpd.conf && reloadapache'
alias ehttpd='$EDITOR ~/Sites/httpd.conf && reloadapache'

alias mysqlstart='sudo /opt/local/bin/mysqld_safe5 &'
alias mysqlstop='/opt/local/bin/mysqladmin5 -u root -p shutdown'

### functions

function sta() {
  if test -d .svn
  then
    echo "SVN status..."
    ruby ~/.zsh/scripts/sta.rb --ignore-externals
  else
    git branch && git status
  fi
}

alias ta='sta'

#function push() {
  #if test -f .git/config; then
    #if grep svn-remote .git/config > /tmp/nul; then
      #echo "Pushing via git-svn..."
      #git svn dcommit
    #else
      #echo "Pushing via git..."
      #git push
    #fi  
  #fi
#}

function sup() {
  if test -d .svn
  then
    svn update --ignore-externals
  elif test -d .git
  then
    git-svn rebase
  fi      
}

killany() {
  kill -TERM `ps -ef | grep "$1" | grep -v grep | awk '{print $2}'`
}

w() {
  p $1
  m
  hcl start $1
  et
}

alias sprof='source ~/.zshrc'
alias eprof='mate ~/dotfiles'

# reload all functions
r() {
  local f
  f=(~/.zsh/functions/*(.))
  unfunction $f:t 2> /dev/null
  autoload -U $f:t
}

ssh-install-key() {
  ssh $1 "([ -d ~/.ssh ] || mkdir -m 700 ~/.ssh); touch ~/.ssh/authorized_keys && chmod 600 ~/.ssh/authorized_keys && echo `cat ~/.ssh/id_rsa.pub` >> ~/.ssh/authorized_keys"
}
